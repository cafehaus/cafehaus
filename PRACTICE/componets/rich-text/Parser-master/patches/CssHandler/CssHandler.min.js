function e(e,t){if(!(e&&e.length&&t&&t.length))return!1;if(1==e.length&&1==t.length)return e[0]==t[0];if(e.length<t.length)return!1;for(var n=t.length;n--;){for(var i=!1,r=e.length;r--;)e[r]==t[n]&&(i=!0);if(!i)return!1}return!0}function t(t,n,i,r){if("*"==r)return 0;var s=r.match(/^[^.#\s]+/),a=r.match(/\.[^.#\s]+/g),l=r.match(/#[^.#\s]+/);return l?i==l?a&&!e(n,a)||s&&t!=s[0]?-1:2:-1:a?e(n,a)?s&&t!=s[0]?-1:1:-1:s&&t==s[0]?0:-1}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];this.screenWidth=t,this.styles=[];var n=Object.assign({},r.userAgentStyles);for(var i in e)n[i]=(n[i]?n[i]+";":"")+e[i];for(var s in n)this.styles.push({key:s,content:n[s]})}function i(e,t,n){function i(){for(var t=1,n=s+1;n<e.length;n++)if("{"==e[n])t++;else if("}"==e[n]&&0==--t)break;a=n+1}var r,s,a=0;for(e=e.replace(/\/\*[\s\S]*?\*\//g,"");a<e.length&&-1!=(s=e.indexOf("{",a));){var l=e.substring(a,s);if("@"!=l[0])if(l=l.trim(),"}"==l[0]&&(l=l.substring(1)),"."==l[0]||"#"==l[0]||"["==l[0]||"*"==l[0]||l>="a"&&l<="z"||l>="A"&&l<="Z"){var o=l.split(",");if(a=s+1,-1==(s=e.indexOf("}",a)))break;var u=e.substring(a,s);a=s+1;for(var h=0;h<o.length;h++){var d={key:o[h].trim(),content:u};if(!d.key.includes(":")||(r=d.key.split(":"),d.key=r[0].trim(),d.pseudo=r.pop(),"before"==d.pseudo||"after"==d.pseudo)){if(d.key.includes("[")&&(d.attr=[],d.key=d.key.replace(/\[(.+?)\]/g,function(e,t){if(t.includes("=")){r=t.split("=");var n=r[1].trim();('"'==n[0]&&'"'==n[n.length-1]||"'"==n[0]&&"'"==n[n.length-1])&&(n=n.substring(1,n.length-1)),d.attr.push({name:r[0].trim(),value:n})}else d.attr.push({name:t.trim()});return""}).trim(),d.key||(d.key="*")),d.key.includes(" ")||d.key.includes(">")){var f=d.key.replace(/\s*>\s*/g," >").split(/\s+/);d.list=f,d.key=f[0],d.index=0}t.push(d)}}}else i();else if("@media"==l.substring(0,6)){if((r=l.match(/\((.+?):(.+?)\)/))&&r[2].includes("px")){var c=parseInt(r[2]);if("min-width"==r[1]&&n>c||"max-width"==r[1]&&n<c){a=s+1;continue}i()}}else i()}}var r=require("./config.js");n.prototype.getStyle=function(e){i(e,this.styles,this.screenWidth)},n.prototype.match=function(e,n,i){var r=[];if(n.class)for(var s=n.class.split(/\s+/),a=s.length;a--;)r.unshift("."+s[a]);var l,o=[],u=!1;i.i=[],i.index=[],i.pseudo=[];for(var h,d=0;h=this.styles[d];d++){">"==h.key[0]?(l=h.key.substring(1),u=!0):(l=h.key,u=!1);var f=t(e,r,n.id?"#"+n.id:"",l);if(-1!=f)if(Object.hasOwnProperty.call(h,"index")&&h.index!=h.list.length-1)i.i.push(d),i.index.push(h.index),h.index++,h.key=h.list[h.index];else{var c=!0;if(h.attr)for(var p=0;p<h.attr.length;p++)Object.hasOwnProperty.call(h.attr[p],"value")?n[h.attr[p].name]!=h.attr[p].value&&(c=!1):Object.hasOwnProperty.call(n,h.attr[p].name)||(c=!1);c&&(h.pseudo&&i.pseudo.push(h),h.list?o[3]+=";"+h.content:o[f]+=";"+h.content)}u&&(i.i.push(d),i.index.push(h.index),h.index--,h.key=h.list[h.index])}return i.i.length||(i.i=void 0,i.index=void 0),i.pseudo.length||(i.pseudo=void 0),o.join(";")+";"},n.prototype.pop=function(e){if(e.i){for(var t=0;t<e.i.length;t++){var n=e.i[t];this.styles[n].key=this.styles[n].list[e.index[t]],this.styles[n].index=e.index[t]}e.i=void 0,e.index=void 0}if(e.pseudo)for(var i=0;i<e.pseudo.length;i++){var r,s=e.pseudo[i].content.replace(/content:([^;\n]*)/,function(t,n){return r=n.replace(/attr\((.+?)\)/,function(t,n){return e.attrs[n.trim()]||""}).replace(/\s*['"](.*?)['"]\s*/g,"$1").replace(/\\(\w{4})/,function(e,t){return String.fromCharCode(parseInt(t,16))}),""}),a={name:"span",attrs:{style:s},children:[{type:"text",text:r}]};"before"==e.pseudo[i].pseudo?e.children.unshift(a):e.children.push(a)}},module.exports=n